{% extends "base.html" %}

{% block content %}
<div class="layout">
  <h1>ğŸ¤– AI ë¦¬í¬íŠ¸</h1>

  <div>
    <div class="card-header d-flex justify-content-between align-items-center">
      <span id="ai-report-date">AI ë¦¬í¬íŠ¸</span>
      <small id="ai-report-created-at" class="text-muted"></small>
    </div>

    <div>

      <!-- 1) ì¼ì¼ íŠ¸ë ˆì´ë“œ ë¦¬í¬íŠ¸ -->
      <div>
        <h5>ğŸ“Š ì¼ì¼ íŠ¸ë ˆì´ë“œ ë¦¬í¬íŠ¸</h5>
        <pre id="ai-daily-report" class="card"
             style="white-space:pre-wrap; max-height:400px; overflow:auto; font-size:0.9rem; font-family: Pretendard; line-height: 1.5; font-weight: 300;"></pre>
      </div>

      <!-- 2) ì „ëµ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë° -->
      <div>
        <h5>ğŸ§  ì „ëµ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë°</h5>
        <pre id="ai-strategy-ideas" class="card"
             style="white-space:pre-wrap; max-height:400px; overflow:auto; font-size:0.9rem; font-family: Pretendard; line-height: 1.5; font-weight: 300;"></pre>
      </div>

      <!-- 3) ëª¨ë¸ ì—…ë°ì´íŠ¸ / íŠœë‹ ì¡°ì–¸ -->
      <div>
        <div class="d-flex justify-content-between align-items-center">
          <h5>ğŸ›  ëª¨ë¸ ì—…ë°ì´íŠ¸ / íŠœë‹ ì¡°ì–¸</h5>
          <small id="ai-model-advice-date" class="text-muted"></small>
        </div>
        <pre id="ai-model-advice" class="card"
             style="white-space:pre-wrap; max-height:400px; overflow:auto; font-size:0.9rem; font-family: Pretendard; line-height: 1.5; font-weight: 300;"></pre>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadAiReportFull() {
  try {
    const res = await fetch('/api/ai-report/full');
    if (!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    const dateLabel = data.date
      ? `${data.date} ê¸°ì¤€ AI ë¦¬í¬íŠ¸`
      : 'AI ë¦¬í¬íŠ¸ (ë°ì´í„° ì—†ìŒ)';
    document.getElementById('ai-report-date').textContent = dateLabel;

    if (data.created_at) {
      document.getElementById('ai-report-created-at').textContent =
        `ìƒì„± ì‹œê°: ${data.created_at}`;
    } else {
      document.getElementById('ai-report-created-at').textContent = '';
    }

    document.getElementById('ai-daily-report').textContent =
      data.daily_report && data.daily_report.trim()
        ? data.daily_report
        : 'ì•„ì§ ìƒì„±ëœ ì¼ì¼ íŠ¸ë ˆì´ë“œ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';

    document.getElementById('ai-strategy-ideas').textContent =
      data.strategy_ideas && data.strategy_ideas.trim()
        ? data.strategy_ideas
        : 'ì•„ì§ ìƒì„±ëœ ì „ëµ ì•„ì´ë””ì–´ ë¸Œë ˆì¸ìŠ¤í† ë° ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';

    const modelAdviceDate = data.model_advice_date
      ? `(${data.model_advice_date} ê¸°ì¤€)`
      : '';
    document.getElementById('ai-model-advice-date').textContent = modelAdviceDate;

    document.getElementById('ai-model-advice').textContent =
      data.model_advice && data.model_advice.trim()
        ? data.model_advice
        : 'ì•„ì§ ì €ì¥ëœ ëª¨ë¸ ì—…ë°ì´íŠ¸/íŠœë‹ ì¡°ì–¸ì´ ì—†ìŠµë‹ˆë‹¤.\n\n' +
          'ğŸ‘‰ daily_ml_cycle.pyë¥¼ í•œ ë²ˆ ì‹¤í–‰í•˜ë©´ reports/ ì•„ë˜ì—\n' +
          '   *_model_advice.txt íŒŒì¼ì´ ìƒì„±ë˜ê³  ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.';
  } catch (err) {
    console.error('AI ë¦¬í¬íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', err);
    document.getElementById('ai-daily-report').textContent =
      'AI ë¦¬í¬íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
    document.getElementById('ai-strategy-ideas').textContent = '';
    document.getElementById('ai-model-advice').textContent =
      'ëª¨ë¸ ì¡°ì–¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
  }
}

document.addEventListener('DOMContentLoaded', () => {
  loadAiReportFull();
});
</script>
{% endblock %}
