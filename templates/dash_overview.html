{% extends "base.html" %}

{% block content %}
<div class="layout">
  <h1>ğŸ“ˆ Trading Dashboard</h1>

  <!-- ìš”ì•½ ì¹´ë“œ -->
  <div class="summary-grid">
    <div class="card">
      <div class="summary-item-title">ì´ íŠ¸ë ˆì´ë“œ ìˆ˜</div>
      <div class="summary-item-value">{{ summary.total_trades }}</div>
    </div>
    <div class="card">
      <div class="summary-item-title">ìŠ¹ë¥  (%)</div>
      <div class="summary-item-value {% if summary.win_rate >= 50 %}pill-positive{% else %}pill-negative{% endif %}">
        {{ "%.2f"|format(summary.win_rate) }}
      </div>
    </div>
    <div class="card">
      <div class="summary-item-title">íŠ¸ë ˆì´ë“œë‹¹ í‰ê·  ìˆ˜ìµë¥  (%)</div>
      <div class="summary-item-value {% if summary.avg_profit >= 0 %}pill-positive{% else %}pill-negative{% endif %}">
        {{ "%.2f"|format(summary.avg_profit) }}
      </div>
    </div>
    <div class="card">
      <div class="summary-item-title">ëˆ„ì  ìˆ˜ìµë¥  (%)</div>
      <div class="summary-item-value {% if summary.cum_return_pct >= 0 %}pill-positive{% else %}pill-negative{% endif %}">
        {{ "%.2f"|format(summary.cum_return_pct) }}
      </div>
    </div>
  </div>

  <!-- Equity Curve -->
  <div class="card section">
    <h2>ğŸ“ˆ Equity Curve</h2>
    <canvas id="equityChart" height="120"></canvas>
  </div>

  <!-- ì¢…ëª©ë³„ í‰ê·  ìˆ˜ìµë¥  -->
  <div class="card section">
    <h2>ğŸ“Š ì¢…ëª©ë³„ í‰ê·  ìˆ˜ìµë¥ </h2>
    <canvas id="symbolChart" height="120"></canvas>
  </div>

  <!-- ì˜¤ëŠ˜ì˜ ML í•™ìŠµ ìš”ì•½ & ê°œì„ ì•ˆ -->
  <div class="section">
    <div class="card">
      <h2>ğŸ¤– ì˜¤ëŠ˜ì˜ ML í•™ìŠµ ìš”ì•½ & ê°œì„  ì œì•ˆ</h2>
      {% if suggestions and suggestions|length > 0 %}
        <ul class="suggest-list">
          {% for s in suggestions %}
            <li>{{ s }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p style="font-size:13px; color:#9da4c2; margin-top:6px;">
          ì˜¤ëŠ˜ì€ ì•„ì§ ë¶„ì„í•  ì‹ í˜¸ê°€ ì¶©ë¶„íˆ ì—†ìŠµë‹ˆë‹¤. ì¥ ë§ˆê° í›„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const equityData = JSON.parse('{{ equity_curve | tojson | safe }}');
  const symbolData = JSON.parse('{{ symbols_avg | tojson | safe }}');

  // Equity Curve
  (function () {
    const ctx = document.getElementById('equityChart');
    if (!ctx || equityData.length === 0) return;

    const labels = equityData.map(d => d.time);
    const values = equityData.map(d => d.value);

    new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [{
          data: values,
          borderWidth: 1.5,
          tension: 0.2,
          pointRadius: 0,
          borderColor: 'rgba(248,250,252,0.9)',
          backgroundColor: 'rgba(248,250,252,0.10)',
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { maxTicksLimit: 6 } },
          y: { ticks: { callback: v => v + '%' } }
        }
      }
    });
  })();

  // Symbol avg profit
  (function () {
    const ctx = document.getElementById('symbolChart');
    if (!ctx || symbolData.length === 0) return;

    const labels = symbolData.map(d => d.symbol);
    const values = symbolData.map(d => d.avg_profit);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          data: values,
          borderWidth: 1,
          backgroundColor: 'rgba(56,189,248,0.6)',
          borderColor: 'rgba(56,189,248,0.9)',
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          y: { ticks: { callback: v => v + '%' } }
        }
      }
    });
  })();
</script>
{% endblock %}
